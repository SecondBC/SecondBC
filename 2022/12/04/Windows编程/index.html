<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Windows编程"><meta name="keywords" content="Win"><meta name="author" content="Second_BC,undefined"><meta name="copyright" content="Second_BC"><title>Windows编程【Second_BC の BloG】</title><link rel="stylesheet" href="/SecondBC/css/fan.css"><link rel="stylesheet" href="/SecondBC/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/SecondBC/favicon.ico"><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/SecondBC/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/SecondBC/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: ,
  valine: ,
}</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/SecondBC/atom.xml" title="Second_BC の BloG" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">主函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B9%E7%AA%97"><span class="toc-number">3.</span> <span class="toc-text">弹窗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">字符串处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">5.</span> <span class="toc-text">创建窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">消息处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.1.</span> <span class="toc-text">类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81"><span class="toc-number">6.2.</span> <span class="toc-text">发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E5%8F%82%E5%87%BD%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">变参函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E6%8E%A7%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">窗口控件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.</span> <span class="toc-text">窗口操作函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%93%8D%E4%BD%9C"><span class="toc-number">8.</span> <span class="toc-text">资源操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">8.1.</span> <span class="toc-text">对话框</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%8E%A7%E4%BB%B6"><span class="toc-number">9.</span> <span class="toc-text">列表控件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lab"><span class="toc-number">10.</span> <span class="toc-text">Lab</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/SecondBC/ss.jpg"></div><div class="author-info-name">Second_BC</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/" target="_blank">GitHub<i class="icon-dot bg-color9"></i></a><a class="links-button button-hover" href="mailto:1" target="_blank">E-Mail<i class="icon-dot bg-color8"></i></a><a class="links-button button-hover" href="tencent://message/?uin=2&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color2"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/SecondBC/archives"><span class="pull-top">日志</span><span class="pull-bottom">38</span></a><a class="author-info-articles-tags article-meta" href="/SecondBC/tags"><span class="pull-top">标签</span><span class="pull-bottom">10</span></a><a class="author-info-articles-categories article-meta" href="/SecondBC/categories"><span class="pull-top">分类</span><span class="pull-bottom">3</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/SecondBC">首页</a><a class="menu-item" href="/SecondBC/archives">归档</a><a class="menu-item" href="/SecondBC/categories">分类</a><a class="menu-item" href="/SecondBC/tags">标签</a><a class="menu-item" href="/SecondBC/about">关于</a></nav><div class="right-info"><a class="title-name" href="/SecondBC/">Second_BC の BloG</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Windows编程</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2022-12-04 | 更新于 2022-12-04</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/SecondBC/categories/Diary/">Diary</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/SecondBC/tags/Win/">Win</a></div></div></div><div class="main-content"><p>重要头文件：windows.h；</p>
<p>word 是字，占2个字节；</p>
<p>不会的函数可以去微软查出来，vs里选中F1；</p>
<p>链接器 子系统 选择 窗口；</p>
<p>windows是操作<strong>消息</strong>的，它有一个消息队列，可获取如鼠标键盘产生的消息；</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li><p>UINT    unsigned int</p>
</li>
<li><p>DWORD   double word</p>
</li>
<li><p>PDWORD  pointer double word</p>
</li>
<li><p>BOOL     bool</p>
</li>
<li><p>short    short int</p>
</li>
<li><p>LRSULT   32 函数返回值</p>
</li>
<li><p>WPARAM LPARAM  32 消息参数</p>
</li>
<li><p>HANDLE    理解成windows对象，句柄</p>
</li>
<li><p>HWND      窗口句柄</p>
</li>
<li><p>HINSTANCE 实例句柄</p>
</li>
</ul>
<h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hInstance,		<span class="comment">//程序的实例句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    HINSTANCE hPreInstance,		<span class="comment">//上一个程序实例句柄（遗弃）</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPSTR lpCmdLine,			<span class="comment">//命令行参数</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> nCmdShow				<span class="comment">//显示方式（最大化，窗口）</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure>

<p>参数一个不能少；</p>
<h2 id="弹窗"><a href="#弹窗" class="headerlink" title="弹窗"></a>弹窗</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MessageBox</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	HWND hWnd;				<span class="comment">//所有者窗口句柄（父级窗口） 无可填NULL</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPCTSTR lpText;			<span class="comment">//显示内容</span></span></span></span><br><span class="line"><span class="params"><span class="function">    LPCTSTR lpCaption,		<span class="comment">//标题</span></span></span></span><br><span class="line"><span class="params"><span class="function">    UINT uType				<span class="comment">//风格（确认，取消一类的按键）</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>选择不同的按键返回不同的值；</p>
<h2 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h2><ul>
<li>ascii码对应普通字符串 CHAR -&gt; char</li>
<li>utf系列对应宽字符串  WCHAR -&gt; wchar_t 输出是 %ls  用 L 修饰</li>
<li>通用字符串          TCHAR -&gt; 类型随环境变化，引用 tchar.h 头  用_T（）修饰；</li>
</ul>
<p>由此引申出了三个版本的操作函数；</p>
<p><strong>长度操作</strong>：</p>
<p>strlen wcslen _tcslen</p>
<p><strong>字符串转数字</strong>：</p>
<p>atoi strtol</p>
<p>_wtoi wcstol</p>
<p>_ttoi tcstol</p>
<p><strong>数字转字符串</strong>：</p>
<p>itoa _itow _itot</p>
<p>因为字符串，所以分三个版本：A W T；</p>
<p>如 MessageBoxA ，以及 MessageBoxW ，前者处理多字节，后者处理宽字节；</p>
<p>字节转换：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//宽字节转多字节  (用的时候直接用宏定义)</span></span><br><span class="line"><span class="built_in">WideCharToMultiByte</span>()</span><br><span class="line">---</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WCHAR_TO_CHAR(lpW_Char, lpChar) \</span></span><br><span class="line"><span class="meta">WideCharToMultiByte(CP_ACP, NULL, lpW_Char, -1, \</span></span><br><span class="line"><span class="meta">lpChar, sizeof(lpChar), NULL, FALSE)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//多字节转宽字节</span></span><br><span class="line"><span class="built_in">MultiByteToWideChar</span>()</span><br><span class="line">---</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CHAR_TO_WCHAR(lpChar, lpWchar) \</span></span><br><span class="line"><span class="meta">MultiByteToWideChar(CP_ACP, NULL, lpChar, -1, \</span></span><br><span class="line"><span class="meta">lpWchar, sizeof(lpWchar))</span></span><br></pre></td></tr></table></figure>



<h2 id="创建窗口"><a href="#创建窗口" class="headerlink" title="创建窗口"></a>创建窗口</h2><p>先创建WinMain函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//都用W版本</span></span><br><span class="line">	<span class="comment">//创建窗口类</span></span><br><span class="line">	WNDCLASSW wnd = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	wnd.lpszClassName = <span class="string">L&quot;Second_BC&quot;</span>;	<span class="comment">//类名唯一</span></span><br><span class="line">	wnd.lpfnWndProc = WindowProc;		<span class="comment">//窗口回调函数</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//注册窗口类</span></span><br><span class="line">	<span class="built_in">RegisterClassW</span>(&amp;wnd);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建窗口</span></span><br><span class="line">	HWND window = <span class="built_in">CreateWindowW</span>(</span><br><span class="line">					wnd.lpszClassName,	<span class="comment">//类名</span></span><br><span class="line">					<span class="string">L&quot;1049&quot;</span>,			<span class="comment">//窗口名</span></span><br><span class="line">					WS_OVERLAPPEDWINDOW,<span class="comment">//风格</span></span><br><span class="line">					CW_USEDEFAULT,		<span class="comment">//x,y坐标，默认款式</span></span><br><span class="line">					<span class="number">0</span>,</span><br><span class="line">					CW_USEDEFAULT,		<span class="comment">//长宽，默认款式</span></span><br><span class="line">					<span class="number">0</span>,</span><br><span class="line">					<span class="literal">NULL</span>,				<span class="comment">//父窗口的句柄</span></span><br><span class="line">					<span class="literal">NULL</span>,				<span class="comment">//菜单</span></span><br><span class="line">					hInstance,			<span class="comment">//实例句柄</span></span><br><span class="line">					<span class="number">0</span>					<span class="comment">//传给回调函数参数</span></span><br><span class="line">				);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//显示窗口</span></span><br><span class="line">	<span class="built_in">ShowWindow</span>(</span><br><span class="line">		window,			<span class="comment">//窗口句柄</span></span><br><span class="line">		SW_NORMAL		<span class="comment">//默认显示方式</span></span><br><span class="line">	);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取消息</span></span><br><span class="line">	MSG msg = &#123; <span class="number">0</span> &#125;;	<span class="comment">//消息类</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">GetMessageW</span>(	<span class="comment">//不断获取消息		</span></span><br><span class="line">		&amp;msg,			<span class="comment">//消息类</span></span><br><span class="line">		<span class="number">0</span>,				<span class="comment">//窗口句柄 0默认全部窗口</span></span><br><span class="line">		<span class="number">0</span>,				<span class="comment">//消息类型默认</span></span><br><span class="line">		<span class="number">0</span></span><br><span class="line">	))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">DispatchMessageW</span>(&amp;msg);	<span class="comment">//分发消息给处理函数</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理函数\回调：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ HWND hwnd,			<span class="comment">//窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ UINT uMsg,			<span class="comment">//消息</span></span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ WPARAM wParam,		<span class="comment">//参数</span></span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in"><span class="keyword">switch</span></span> (uMsg)			<span class="comment">//操作消息</span></span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">		<span class="built_in">DestroyWindow</span>(hwnd);<span class="comment">//销毁窗口</span></span><br><span class="line">		<span class="built_in">PostQuitMessage</span>(<span class="number">0</span>); <span class="comment">//退出消息，终止循环</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hwnd, uMsg, wParam, lParam);		<span class="comment">//默认窗口处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单说说回调函数机制：</p>
<p>每个窗口类会带有一个回调函数，用于处理这个类创建的窗口所获取的信息；</p>
<p>在无限循环的信息捕获中，当收到信息后（晃动鼠标，点击，按键），则使得 <code>DispatchMessageW(&amp;msg);</code> 激活，调用指定窗口回调函数；</p>
<p>在这里指定窗口是 0 ，则是所有窗口；</p>
<p>回调函数中，为了当 <strong>点击叉掉</strong> 窗口时就 <strong>结束程序</strong> 就应该设置 退出信息 ： <code>WM_CLOSE</code> 摧毁窗口，并退出 postmessage，此时就会退出在主函数里的循环；</p>
<p>回调函数的参数，第二个是信息，第三第四个是一些参数，这些参数有一定的作用，可以知道实际的状态：键盘按下但无弹起 / 鼠标处于窗口位置，等等；</p>
<h2 id="消息处理"><a href="#消息处理" class="headerlink" title="消息处理"></a>消息处理</h2><p>定义在 WINUSER.H 中， 以 WM_开头 （windows message）；</p>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><ol>
<li><p>窗口消息，如之前遇到的 <code>WM_CLOSE</code> ；</p>
</li>
<li><p>命令消息，特指 <code>WM_COMMAND</code> ，点击菜单，控件等会产生；</p>
<table>
<thead>
<tr>
<th>WM_COMMAND</th>
<th>LOW WPARAM</th>
<th>HIGH WPARAM</th>
<th>LPARAM</th>
</tr>
</thead>
<tbody><tr>
<td>标准控件</td>
<td>id</td>
<td>响应码</td>
<td>控件句柄</td>
</tr>
<tr>
<td>快捷键</td>
<td>id</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>菜单</td>
<td>id</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
</li>
<li><p>通知消息，特指 <code>WM_NOTIFY</code> ，只使用 用 windows 的公共控件，如列表，视图；</p>
<table>
<thead>
<tr>
<th>WM_NOTIFY</th>
<th>WPARAM</th>
<th>LPARAM</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>id</td>
<td>NMHDR指针</td>
</tr>
</tbody></table>
<p>NMHDR -&gt; notify message header</p>
</li>
</ol>
<p>控件消息，如：</p>
<p>BM_    按钮</p>
<p>EM_    编辑框</p>
<p>STM_    静态文本</p>
<p>CM_    组合框</p>
<p>LBM_    列表</p>
<p>以及用户自定义消息，消息号大于 <code>WM_USER</code> ;</p>
<h3 id="发送"><a href="#发送" class="headerlink" title="发送"></a>发送</h3><p>PostMessage， SendMessage；</p>
<p>前者放到消息队列，后者主动调用 指定的回调函数；</p>
<h3 id="变参函数"><a href="#变参函数" class="headerlink" title="变参函数"></a>变参函数</h3><p>用于如printf输出宽字节；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(LPCWSTR format, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    WCHAR wchar_buff[<span class="number">100</span>]&#123; <span class="number">0</span> &#125;;</span><br><span class="line">    va_list arglist;	<span class="comment">//本质char类型，用于存放后面的参数</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">va_start</span>(arglist, format);	<span class="comment">//第二个参数是指针起始+1，也就是后面的参数</span></span><br><span class="line">    <span class="built_in">wvsprintfW</span>(wchar_buff, format, arglist);</span><br><span class="line">    <span class="built_in">va_end</span>(arglist);	<span class="comment">//结束</span></span><br><span class="line">    <span class="built_in">wprintf</span>(format, wchar_buff);	<span class="comment">//输出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="窗口控件"><a href="#窗口控件" class="headerlink" title="窗口控件"></a>窗口控件</h2><p>使用控件引头文件： <code>&lt;CommCtrl.h&gt;</code></p>
<p>窗口风格分两类：</p>
<p>窗口关系:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WS_OVERLAPED	重叠</span><br><span class="line">WS_POPUP		弹窗</span><br><span class="line">WS_CHILD		子窗口</span><br></pre></td></tr></table></figure>

<p>窗口外观：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WS_BORDER</span><br><span class="line">WS_CAPITON</span><br></pre></td></tr></table></figure>

<p>它们之间可以用 | 运算结合使用；</p>
<p>控件的本质，还是窗口，在父窗口创建开始添加即可；</p>
<p>标准控件：</p>
<table>
<thead>
<tr>
<th align="left">类名</th>
<th>名称</th>
</tr>
</thead>
<tbody><tr>
<td align="left">WC_BUTTON</td>
<td>按钮</td>
</tr>
<tr>
<td align="left">WC_STATIC</td>
<td>静态文本</td>
</tr>
<tr>
<td align="left">WC_COMBOBOX</td>
<td>复合框</td>
</tr>
<tr>
<td align="left">WC_EDIT</td>
<td>编辑框</td>
</tr>
<tr>
<td align="left">WC_LISTBOX</td>
<td>列表框</td>
</tr>
<tr>
<td align="left">WC_SCROLLBAR</td>
<td>滚动条</td>
</tr>
</tbody></table>
<p>通用控件，如：</p>
<p>WC_LISTVIEW    列表框控件</p>
<p>WC_TREEVIEW    树控件</p>
<p>WC_TABCONTROL  Tab控件</p>
<p>…</p>
<p>子控件响应父窗口，使用 命令消息 和 通知消息，标准控件使用前者，通用控件使用后者；</p>
<p>修改之后的回调函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ HWND hwnd,			<span class="comment">//窗口句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ UINT uMsg,			<span class="comment">//消息</span></span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ WPARAM wParam,		<span class="comment">//参数</span></span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> HINSTANCE hInstance = <span class="built_in">GetModuleHandleW</span>(<span class="literal">NULL</span>);	<span class="comment">//NULL默认获取当前程序实例句柄</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in"><span class="keyword">switch</span></span> (uMsg)			<span class="comment">//操作消息</span></span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_CREATE:</span><br><span class="line">		<span class="comment">//创建窗口时创建子控件，menu栏是控件ID，存于wParam低位，lParam存控件句柄</span></span><br><span class="line">		<span class="built_in">CreateWindowW</span>(WC_BUTTON, <span class="string">L&quot;Button&quot;</span>, WS_CHILD | WS_VISIBLE, <span class="number">10</span>, <span class="number">10</span>, <span class="number">80</span>, <span class="number">30</span>, hwnd, (HMENU)<span class="number">0x100</span>, hInstance, <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">		<span class="built_in">DestroyWindow</span>(hwnd);<span class="comment">//销毁窗口</span></span><br><span class="line">		<span class="built_in">PostQuitMessage</span>(<span class="number">1</span>); <span class="comment">//退出消息</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//激活控件，获取控件ID，执行相应操作</span></span><br><span class="line">		WORD controlId = <span class="built_in">LOWORD</span>(wParam);</span><br><span class="line">		<span class="built_in"><span class="keyword">switch</span></span> (controlId)</span><br><span class="line">		&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x100</span>:</span><br><span class="line">			<span class="built_in">MessageBoxW</span>(hwnd, <span class="string">L&quot;Click&quot;</span>, <span class="string">L&quot;Button&quot;</span>, MB_OK);</span><br><span class="line">           	<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hwnd, uMsg, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上可以实现一个按钮弹窗功能；</p>
<h3 id="窗口操作函数"><a href="#窗口操作函数" class="headerlink" title="窗口操作函数"></a>窗口操作函数</h3><p>背景刷</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wnd.hbrBackground = <span class="built_in">CreateSolidBrush</span>(<span class="built_in">RGB</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>));		<span class="comment">//白色背景</span></span><br></pre></td></tr></table></figure>



<p>移动窗口位置</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RECT rect&#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="built_in">GetClientRect</span>(hwnd, &amp;rect);					<span class="comment">//获取窗口工作区范围，返回给rect结构体</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x = <span class="built_in">rand</span>() % (rect.right - weight);				<span class="comment">//x,y坐标在工作范围内随机取</span></span><br><span class="line"><span class="keyword">int</span> y = <span class="built_in">rand</span>() % (rect.bottom - height);</span><br><span class="line"></span><br><span class="line"><span class="built_in">MoveWindow</span>((HWND)lParam, x, y, weight, height, TRUE);	<span class="comment">//移动窗口函数</span></span><br></pre></td></tr></table></figure>



<p>获取和设置文本框内容</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HWND hedit = <span class="built_in">GetDlgItem</span>(hwnd, <span class="number">0x102</span>);		<span class="comment">//获取文本框句柄，第一个是父窗口句柄，第二个是id</span></span><br><span class="line">WCHAR buffer[max]&#123; <span class="number">0</span> &#125;;						<span class="comment">//缓冲区</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">GetWindowTextW</span>(hedit, buffer, max);			<span class="comment">//用按钮实现		</span></span><br><span class="line"><span class="built_in">SetWindowTextW</span>(hedit, <span class="string">L&quot;123&quot;</span>);</span><br><span class="line">---</span><br><span class="line"><span class="comment">//实际上，对于Dlg的操作可以简化，下面等价于获取hedit之后写文本框</span></span><br><span class="line"><span class="built_in">SetDlgItemTextW</span>(hwnd, <span class="number">0x102</span>, <span class="string">L&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">TranslateMessage</span>(&amp;msg);						<span class="comment">//放到message循环里，接收键盘信息编辑文本框</span></span><br></pre></td></tr></table></figure>



<p>根据窗口名获取句柄</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HWND hwnd = <span class="built_in">FindWindowW</span>(ClassName, Name);		<span class="comment">//第一个窗口类名，第二个窗口名，不知道可以填0</span></span><br></pre></td></tr></table></figure>



<p>设置父窗口</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetParent</span>((HWND)lParam, hwnd);			<span class="comment">//第一个是要被设置的，第二个是新的父窗口</span></span><br></pre></td></tr></table></figure>



<h2 id="资源操作"><a href="#资源操作" class="headerlink" title="资源操作"></a>资源操作</h2><p>资源就是icon，光标，菜单一类的东西;</p>
<p>在VS里，代码下方可以创建资源，资源创建后，有资源本身，有.rc文件，以及resource.h头文件；</p>
<p>.rc保存了资源本身在文件中的宏命名，一般是int型，而头文件则是声明；</p>
<p>引入头后，使用 <code>LoadXXX</code> 函数获取资源句柄（XXX为资源类型，如图标是Icon）；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">LoadCursor</span>(hInstance, <span class="built_in">MAKEINTRESOURCE</span>(IDC_CURSOR1))</span><br></pre></td></tr></table></figure>

<p>参数类型第一个为实例句柄，第二个为资源宏，本质上是个指针，所以要强转，微软自带强转宏函数 <code>MAKEINTRESOURCE()</code> ；</p>
<p>使用如下代码设置类成员：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//三个参数，第一个为窗口句柄，第二个为GCL_开头宏对应成员如GCL_ICON，第三个为设置的句柄，记得强转long</span></span><br><span class="line"><span class="built_in">SetClassLong</span>(hwnd, GCL_ICON, (<span class="keyword">long</span>)handle);		</span><br></pre></td></tr></table></figure>



<p>菜单可以加载后给CreateWindow函数；</p>
<p>子菜单响应也是 WM_COMMAND；</p>
<p>使用以下函数获取子菜单以及弹出菜单：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GetSubMenu</span>(hMenu, <span class="number">0</span>); 		<span class="comment">//第一个父菜单，第二个相对于父菜单位置</span></span><br><span class="line"><span class="built_in">TrackPopupMenu</span>(hMenu, TPM_RIGHTALICGN, x, y, <span class="number">0</span>, hWnd, <span class="literal">NULL</span>);	<span class="comment">//第二个为对齐方式</span></span><br></pre></td></tr></table></figure>

<p>转换坐标当前窗口</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POINT point &#123; <span class="number">0</span> &#125;;</span><br><span class="line">point.x = x;</span><br><span class="line">point.y = y;</span><br><span class="line"><span class="built_in">ClientToScreen</span>(hwnd, &amp;point);</span><br></pre></td></tr></table></figure>



<h3 id="对话框"><a href="#对话框" class="headerlink" title="对话框"></a>对话框</h3><p>模态的会阻塞主窗口（无法点击主窗口），非模态不会；</p>
<p>创建非模态：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CreateDialogW</span>(		</span><br><span class="line">    hInstance,</span><br><span class="line">    dialogName,		<span class="comment">//ID</span></span><br><span class="line">    <span class="literal">NULL</span>,			<span class="comment">//父窗口句柄</span></span><br><span class="line">    Dlgproc			<span class="comment">//回调函数</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function">INT_PTR CALLBACK <span class="title">Dlgproc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	HWND hwnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    UINT uMsg,</span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span>(uMsg)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_INITDIALOG:		<span class="comment">//初始化</span></span><br><span class="line">    	&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">    	&#125;</span><br><span class="line">    <span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">DestroyWindow</span>(hWnd);</span><br><span class="line">            <span class="built_in">QuitPostMessage</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    	<span class="keyword">return</span> FALSE;	<span class="comment">//没能处理返回无</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    	<span class="keyword">return</span> TRUE;	<span class="comment">//处理返回真</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建模态：</p>
<p>它不需要捕获信息，也不需要显示</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DialogBoxW</span>( <span class="comment">/* same */</span>)</span><br><span class="line"><span class="comment">//结束</span></span><br><span class="line"><span class="built_in">EndDialog</span>(hWnd, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>



<p>介绍一些简单的控件：</p>
<p>windowsx.h 头有定义操作控件信息的宏，可读性更高；</p>
<p>复选框，单选框，属于按钮类，其信息为 BM_打头；</p>
<p>图片，其信息 STM_打头；</p>
<p>滑块和进度条，其信息 TBM_ PBM_ 打头；</p>
<h2 id="列表控件"><a href="#列表控件" class="headerlink" title="列表控件"></a>列表控件</h2><p>任务管理器就是一个列表；</p>
<p>其重要的信息是 ： <code>LVM_INSERTCOLUMN</code> ，插入索引；</p>
<p>其会用到一个结构：LVCOLUMN，其中标识了列表信息；</p>
<p>mask是掩码，说明了之后的成员有效性；</p>
<p>fmt是对齐方式，cx是大小，pszText为名字；</p>
<p>插入行： <code>LVM_INSERTITEM</code> ；</p>
<p>设置行： <code>LVM_SETITEMTEXT</code> ；</p>
<p>其结构和上面类似，叫 LVITEM；</p>
<p>item是第几行，subitem是第几列；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">InsertColum</span><span class="params">(HWND hwnd, <span class="keyword">int</span> id, <span class="keyword">int</span> nColum, <span class="keyword">int</span> cx, LPWSTR name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LVCOLUMNW lvColumn = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	lvColumn.mask = LVCF_FMT | LVCF_WIDTH | LVCF_TEXT;</span><br><span class="line">	lvColumn.fmt = LVCFMT_CENTER;</span><br><span class="line">	lvColumn.cx = cx;</span><br><span class="line">	lvColumn.pszText = name;</span><br><span class="line">	<span class="built_in">SendDlgItemMessageW</span>(hwnd, id, LVM_INSERTCOLUMNW, nColum, (LPARAM) &amp; lvColumn);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">InsertItem</span><span class="params">(HWND hwnd, <span class="keyword">int</span> id, <span class="keyword">int</span> item)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LVITEMW lvItem = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	lvItem.mask = LVIF_TEXT;</span><br><span class="line">	lvItem.iItem = item;</span><br><span class="line">	lvItem.pszText = (LPWSTR)<span class="string">L&quot;&quot;</span>;</span><br><span class="line">	<span class="built_in">SendDlgItemMessageW</span>(hwnd, id, LVM_INSERTITEMW, <span class="number">0</span>, (LPARAM)&amp;lvItem);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">SetListItemText</span><span class="params">(HWND hwnd, <span class="keyword">int</span> id, <span class="keyword">int</span> item, <span class="keyword">int</span> subItem, LPWSTR name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LVITEMW lvItem = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	lvItem.mask = LVIF_TEXT;</span><br><span class="line">	lvItem.iItem = item;</span><br><span class="line">	lvItem.iSubItem = subItem;</span><br><span class="line">	lvItem.pszText = name;</span><br><span class="line">	<span class="built_in">SendDlgItemMessageW</span>(hwnd, id, LVM_SETITEMTEXTW, item, (LPARAM)&amp;lvItem);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加样式：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sendDlgItemMessageW</span>(hwnd, id, LVM_SETEXTENDEDLISTVIEWSTYLE, <span class="number">0</span>, style)</span><br></pre></td></tr></table></figure>

<p>常用style有：LVS_EX_FULLROWSELECT ， 全行选中；</p>
<p>​            LVS_EX_GRIDLINES    ,  添加网格；</p>
<p>点击其成员触发notify信息，其有 NMHDR 结构：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">nmhdr</span> &#123;</span></span><br><span class="line">  HWND hwndFrom;		<span class="comment">//发起信息句柄	</span></span><br><span class="line">  UINT idFrom;			<span class="comment">//id</span></span><br><span class="line">  UINT code;			<span class="comment">//操作码</span></span><br><span class="line">&#125; NMHDR;</span><br></pre></td></tr></table></figure>

<p>如果确认控件是list，则结构体为 NMLISTVIEW ，为 NMHDR 的继承；</p>
<p>捕获点击消息：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_NOTIFY:</span><br><span class="line">&#123;</span><br><span class="line">    NMHDR* pnmHeader = (NMHDR*)lParam;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span>(pnmHeader-&gt;code)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> NM_CLICK:</span><br><span class="line">            &#123;</span><br><span class="line">                ...</span><br><span class="line">               	<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种捕获类似于下拉表；</p>
<p>获取dll文件函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HMODULE hModule = <span class="built_in">LoadLibraryW</span>(<span class="string">L&quot;./mydll.dll&quot;</span>);</span><br><span class="line"><span class="built_in">GetProcAddress</span>(hModule, <span class="string">&quot;func_name&quot;</span>);	<span class="comment">//返回一个函数指针</span></span><br><span class="line"><span class="built_in">FreeLibrary</span>(hModule);</span><br></pre></td></tr></table></figure>



<h2 id="Lab"><a href="#Lab" class="headerlink" title="Lab"></a>Lab</h2><p>搓了个CPP的类粘合着窗口化编程使用做了个小程序，提取码 <code>a333</code> ;</p>
<p><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1GSH23Z8ROKBB35PUa_Swxw">原神伤害云计算</a>；</p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Second_BC</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://secondbc.github.io/SecondBC/2022/12/04/Windows%E7%BC%96%E7%A8%8B/">https://secondbc.github.io/SecondBC/2022/12/04/Windows%E7%BC%96%E7%A8%8B/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://secondbc.github.io/SecondBC">Second_BC の BloG</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/SecondBC/2022/12/12/DLL%E6%B3%A8%E5%85%A5%E4%B8%8EHOOK/"><i class="fas fa-angle-left">&nbsp;</i><span>DLL注入与HOOK</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/SecondBC/2022/11/12/PE%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%E5%99%A8/"><span>PE简单解析器</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2022 ～ 2024 By Second_BC</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/SecondBC/js/copy.js"></script><!--script(src=url)--></body></html>